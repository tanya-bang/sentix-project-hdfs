# 🛠️ crawling.py 개선 요약표

기존 `_1_crawling.py` 구조를 유지하면서, **중복 제거·책임 분리·로직 안정성 향상**을 위해 다음과 같은 개선이 이루어졌습니다.

| 항목 | 기존 구조 (`_1_crawling.py`) | 개선 구조 (`crawling_improved`) | 변경 이유 및 효과 |
|------|------------------------------|----------------------------|-------------------|
| **1. 중복된 경로(path) 정의** | 댓글 수집과 저장에서 동일한 `path`를 중복 선언 | `comment_path` 변수로 상단 1회 정의 후 모든 함수에 전달 | 유지보수 편의성 증가, 실수 방지 |
| **2. 날짜 조건 중단 위치** | `collect_recent_comments()` 내부 루프 중간에 `return` | loop 순회 후 `stop=True`로 처리, 다음 chunk 안 돌도록 설계 | chunk 내 데이터 유실 방지, 안정성 향상 |
| **3. 최신 댓글 ID 비교 중단 위치** | 중간에 `return` | 위와 동일하게 `stop=True`로 제어 흐름 통일 | 위와 동일, 수집 누락 방지 |
| **4. `load_latest_comment_id()` 구현 위치** | `stock_name`만 받아 내부에서 경로 구성 | `client`, `path`를 인자로 받아 외부에서 경로 제어 가능 | 재사용성·유연성 향상, 테스트 가능 |
| **5. client 생성 위치** | 각 함수에서 중복 생성 | 상단에서 1회 생성 후 함수에 전달 | 자원 낭비 방지, 일관된 연결 사용 |
| **6. 인코딩 방식** | `utf-8` (댓글 CSV 입출력) | `utf-8-sig`로 일관성 유지 | 윈도우 호환성 개선 및 기존 파일 포맷 유지 |
| **7. `run()` 구조** | `run()` 함수로 래핑 | 전통적인 `__main__` 진입부 구조로 정리 | 가독성 향상, 인자 주입 용이 |
| **8. 의존성 모듈 구조** | `hdfs`, `pandas`, `requests` 직접 호출 | `infra.hdfs_client`, `infra.util` 경유 호출 | 프로젝트 구조 내 일관된 의존성 관리 |
| **9. 유틸 함수 재사용** | 날짜 문자열 직접 지정 | `cal_std_day()` 함수 활용 | 하드코딩 제거, 코드 재사용성 강화 |
| **10. 주석 및 로그** | 부분적 로그, 주석 없음 | 각 주요 블록에 ✅ 마크 포함 주석 추가 | 리뷰·협업·유지보수 효율성 향상 |
